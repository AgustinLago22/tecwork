# üß™ Testing y Deployment - Gu√≠a Completa

## üìö Teor√≠a: Tipos de Testing en Aplicaciones Web

### Pir√°mide de Testing

```
                    /\
                   /  \
                  / E2E \     ‚Üê Pocos, costosos, alta confianza
                 /______\
                /        \
               / INTEGR.  \   ‚Üê Algunos, moderados, buena cobertura
              /___________\
             /             \
            /    UNITARIOS  \  ‚Üê Muchos, r√°pidos, feedback inmediato
           /_________________\
```

### 1. **Unit Tests** - Funciones individuales
```typescript
// Ejemplo: Testar funci√≥n de validaci√≥n
describe('validateEmail', () => {
  it('should return true for valid email', () => {
    expect(validateEmail('user@example.com')).toBe(true)
  })

  it('should return false for invalid email', () => {
    expect(validateEmail('invalid-email')).toBe(false)
  })
})
```

### 2. **Integration Tests** - APIs y components
```typescript
// Ejemplo: Testar API endpoint
describe('/api/leads', () => {
  it('should create lead with valid data', async () => {
    const response = await request(app)
      .post('/api/leads')
      .send({
        nombre: 'Test User',
        email: 'test@example.com',
        necesidad: 'Web development'
      })

    expect(response.status).toBe(200)
    expect(response.body.success).toBe(true)
  })
})
```

### 3. **End-to-End Tests** - Flujo completo de usuario
```typescript
// Ejemplo: Testar login flow
describe('Login flow', () => {
  it('should login and redirect to dashboard', async () => {
    await page.goto('/login')
    await page.fill('[name="password"]', 'tecwork_admin_2024')
    await page.click('button[type="submit"]')
    await expect(page).toHaveURL('/dashboard')
  })
})
```

## üß™ Manual Testing Strategy (Nuestra Implementaci√≥n)

Como estamos en fase MVP, usamos **Manual Testing** sistem√°tico:

### Checklist de Testing Completo

#### ‚úÖ **1. Authentication Flow**

**Test Case 1.1: Login Exitoso**
```
1. Ir a http://localhost:3000/login
2. Ingresar email: admin@tecwork.com
3. Ingresar password: tecwork_admin_2024
4. Click "Iniciar Sesi√≥n"

Resultado Esperado:
- Redirecci√≥n autom√°tica a /dashboard
- Cookie 'admin-session' creada
- No errores en console
```

**Test Case 1.2: Login Fallido**
```
1. Ir a http://localhost:3000/login
2. Ingresar password: wrong_password
3. Click "Iniciar Sesi√≥n"

Resultado Esperado:
- Mensaje de error "Contrase√±a incorrecta"
- Permanecer en /login
- No redirecci√≥n
```

**Test Case 1.3: Protecci√≥n de Rutas**
```
1. Abrir incognito/private window
2. Ir directamente a http://localhost:3000/dashboard

Resultado Esperado:
- Redirecci√≥n autom√°tica a /login
- Middleware bloqueando acceso
```

**Test Case 1.4: Logout**
```
1. Estar logueado en /dashboard
2. Click "Cerrar Sesi√≥n"

Resultado Esperado:
- Redirecci√≥n a /login
- Cookie 'admin-session' eliminada
```

#### ‚úÖ **2. Form Submissions**

**Test Case 2.1: Formulario de Contacto**
```
1. Ir a http://localhost:3000/contacto
2. Llenar formulario completo:
   - Nombre: "Juan P√©rez"
   - Email: "juan@empresa.com"
   - Tel√©fono: "+549123456789"
   - Empresa: "TechCorp"
   - Tipo de proyecto: "Desarrollo web"
   - Presupuesto: "$5,000 - $10,000"
   - Timeline: "1-3 meses"
   - Mensaje: "Necesitamos una web moderna"
3. Click "Enviar Mensaje"

Resultado Esperado:
- Loading state durante env√≠o
- P√°gina de √©xito despu√©s del env√≠o
- Datos guardados en Supabase
```

**Test Case 2.2: Formulario de Estudiantes**
```
1. Ir a http://localhost:3000/sumate
2. Llenar formulario completo:
   - Nombre: "Ana Garc√≠a"
   - Email: "ana@estudiante.com"
   - Universidad: "UNNE"
   - Carrera: "Ingenier√≠a en Sistemas"
   - A√±o: "3"
   - Rol: "Frontend"
   - Skills: Seleccionar React, JavaScript, CSS
   - Nivel: "Junior"
   - Fecha inicio: "Marzo 2024"
   - Horas/semana: "20"
   - Portfolio: "https://ana-portfolio.com"
   - GitHub: "https://github.com/ana"
   - LinkedIn: "https://linkedin.com/in/ana"
3. Marcar consent checkbox
4. Click "Enviar Aplicaci√≥n"

Resultado Esperado:
- Loading state durante env√≠o
- P√°gina de √©xito despu√©s del env√≠o
- Datos guardados en Supabase
```

#### ‚úÖ **3. Dashboard Functionality**

**Test Case 3.1: Dashboard Data Display**
```
1. Login como admin
2. Verificar dashboard muestra:
   - Total de leads
   - Leads nuevos
   - Total de estudiantes
   - Estudiantes pendientes
   - Lista de leads recientes
   - Lista de estudiantes recientes

Resultado Esperado:
- M√©tricas calculadas correctamente
- Datos mostrados sin errores
- Cards responsivas
```

**Test Case 3.2: Dashboard con Base Vac√≠a**
```
1. Con base de datos vac√≠a
2. Ir a /dashboard

Resultado Esperado:
- M√©tricas en 0
- Mensaje "No hay datos disponibles"
- No errores de JavaScript
```

#### ‚úÖ **4. Error Handling**

**Test Case 4.1: Network Errors**
```
1. Desconectar internet
2. Enviar formulario de contacto

Resultado Esperado:
- Mensaje de error "Error de conexi√≥n"
- Loading state se detiene
- Formulario mantiene datos
```

**Test Case 4.2: Server Errors**
```
1. Simular error de Supabase (credenciales incorrectas)
2. Enviar formulario

Resultado Esperado:
- Mensaje de error apropiado
- No crash de la aplicaci√≥n
- Error logged en console
```

#### ‚úÖ **5. Responsive Design**

**Test Case 5.1: Mobile (375px)**
```
1. Abrir DevTools ‚Üí Responsive mode
2. Seleccionar iPhone SE (375px)
3. Navegar por todas las p√°ginas

Resultado Esperado:
- Layout adaptado a mobile
- Navegaci√≥n funcional
- Forms usables
- Dashboard legible
```

**Test Case 5.2: Tablet (768px)**
```
1. DevTools ‚Üí iPad (768px)
2. Verificar todas las p√°ginas

Resultado Esperado:
- Grid systems adaptados
- Cards en 2 columnas
- Forms c√≥modos de usar
```

**Test Case 5.3: Desktop (1200px+)**
```
1. DevTools ‚Üí Desktop (1200px)
2. Verificar layout completo

Resultado Esperado:
- Dashboard en 4 columnas
- M√°ximo aprovechamiento de espacio
- Todo perfectamente alineado
```

### üîß **Browser Testing**

#### Cross-browser Compatibility
```
Browsers a probar:
‚úÖ Chrome (latest)
‚úÖ Firefox (latest)
‚úÖ Safari (si tienes Mac)
‚úÖ Edge (Windows)

Para cada browser:
- Login flow
- Form submissions
- Dashboard display
- Responsive behavior
```

#### Browser DevTools Testing

**Console Errors:**
```
1. Abrir DevTools (F12)
2. Ir a Console tab
3. Navegar por toda la app
4. Verificar: No errors en rojo
```

**Network Tab:**
```
1. DevTools ‚Üí Network tab
2. Enviar formulario
3. Verificar:
   - POST request a /api/leads exitoso (200)
   - Response JSON correcto
   - No failed requests
```

**Application Tab:**
```
1. DevTools ‚Üí Application tab
2. Login como admin
3. Ir a Cookies ‚Üí localhost:3000
4. Verificar: Cookie 'admin-session=true' existe
```

## üóÑÔ∏è Database Testing

### Verificar Datos en Supabase

**1. Acceder a Supabase Dashboard:**
```
1. Ir a https://supabase.com/dashboard
2. Seleccionar tu proyecto
3. Ir a Table Editor
```

**2. Verificar Tabla `leads`:**
```sql
-- Query para verificar leads
SELECT * FROM leads ORDER BY created_at DESC LIMIT 10;

-- Verificar estructura
\d leads;
```

**3. Verificar Tabla `applicants`:**
```sql
-- Query para verificar applicants
SELECT * FROM applicants ORDER BY created_at DESC LIMIT 10;

-- Verificar estructura
\d applicants;
```

**4. Test Data Integrity:**
```sql
-- Verificar que no hay datos nulos donde no deber√≠an
SELECT * FROM leads WHERE nombre IS NULL OR email IS NULL;
SELECT * FROM applicants WHERE nombre IS NULL OR email IS NULL;

-- Verificar formatos de email
SELECT * FROM leads WHERE email NOT LIKE '%@%';
SELECT * FROM applicants WHERE email NOT LIKE '%@%';
```

### Performance Testing

**Query Performance:**
```sql
-- Explain query plans
EXPLAIN ANALYZE SELECT * FROM leads WHERE status = 'nuevo';
EXPLAIN ANALYZE SELECT * FROM applicants WHERE rol = 'frontend';
```

**Index Verification:**
```sql
-- Verificar que √≠ndices existen
SELECT indexname, tablename FROM pg_indexes
WHERE schemaname = 'public'
AND tablename IN ('leads', 'applicants');
```

## üöÄ Deployment Strategy

### 1. **Preparaci√≥n para Producci√≥n**

#### Environment Variables para Producci√≥n
```bash
# .env.production (NO commitear)
ADMIN_PASSWORD=super_secure_password_2024_prod
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOi...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOi...
NEXT_PUBLIC_APP_URL=https://tecwork.vercel.app
NODE_ENV=production
```

#### Build Testing Local
```bash
# Test production build locally
npm run build
npm start

# Verificar:
- Build exitoso sin errores
- Aplicaci√≥n funciona en modo producci√≥n
- Performance optimizada
```

### 2. **Deployment en Vercel**

#### Setup Inicial
```bash
# Instalar Vercel CLI
npm i -g vercel

# Deploy desde directorio del proyecto
cd C:\Users\LENOVO\tecwork
vercel

# Seguir prompts:
? Set up and deploy "C:\Users\LENOVO\tecwork"? [Y/n] y
? Which scope? ‚Üí tu-username
? Link to existing project? [y/N] n
? What's your project's name? ‚Üí tecwork
? In which directory is your code located? ‚Üí ./
```

#### Configurar Variables de Entorno en Vercel
```bash
# Via Vercel CLI
vercel env add ADMIN_PASSWORD
# Enter value: super_secure_password_2024_prod

vercel env add NEXT_PUBLIC_SUPABASE_URL
# Enter value: https://your-project.supabase.co

vercel env add SUPABASE_SERVICE_ROLE_KEY
# Enter value: eyJhbGciOi...

# O via Vercel Dashboard:
# 1. Ir a vercel.com/dashboard
# 2. Seleccionar proyecto
# 3. Settings ‚Üí Environment Variables
# 4. Agregar todas las variables
```

#### Deploy Commands
```bash
# Deploy a preview
vercel

# Deploy a producci√≥n
vercel --prod

# Ver logs
vercel logs

# Ver domains
vercel domains
```

### 3. **Post-Deployment Testing**

#### Production Health Check
```
1. Verificar URL de producci√≥n carga
2. Test login flow en producci√≥n
3. Test form submissions en producci√≥n
4. Verificar datos se guardan en Supabase
5. Test responsive en dispositivos reales
```

#### Performance Verification
```
1. Google PageSpeed Insights
   - Ir a https://pagespeed.web.dev/
   - Ingresar URL de producci√≥n
   - Verificar scores > 90

2. Lighthouse Audit (Chrome DevTools)
   - F12 ‚Üí Lighthouse tab
   - Run audit en producci√≥n
   - Verificar m√©tricas
```

#### SEO Basic Check
```
1. Verificar meta tags en <head>
2. Verificar URLs amigables
3. Verificar que p√°ginas son indexables
4. Verificar sitemap (si aplicable)
```

### 4. **Monitoring y Maintenance**

#### Error Tracking
```typescript
// Opcional: Integrar Sentry para error tracking
import * as Sentry from "@sentry/nextjs"

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
})
```

#### Analytics
```typescript
// Google Analytics 4 (opcional)
import { GoogleAnalytics } from '@next/third-parties/google'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html>
      <body>{children}</body>
      <GoogleAnalytics gaId="G-XYZ" />
    </html>
  )
}
```

#### Uptime Monitoring
```
Herramientas recomendadas:
- UptimeRobot (gratis)
- Pingdom
- StatusCake

Configurar alerts para:
- Downtime
- Response time > 5s
- Error rates > 5%
```

## üîí Security Testing

### 1. **Authentication Security**

```
Test Cases:
‚úÖ Cookie HttpOnly (no accesible desde JS)
‚úÖ Cookie Secure en HTTPS
‚úÖ Cookie SameSite protection
‚úÖ Password no enviado en logs
‚úÖ Variables de entorno no expuestas
```

### 2. **API Security**

```bash
# Test injection attacks (manual)
curl -X POST https://tu-app.vercel.app/api/leads \
  -H "Content-Type: application/json" \
  -d '{"nombre": "<script>alert(\"xss\")</script>", "email": "test@test.com"}'

# Verificar que data se escapa correctamente
```

### 3. **HTTPS Verification**

```
1. Verificar certificado SSL v√°lido
2. Verificar redirecci√≥n HTTP ‚Üí HTTPS
3. Verificar headers de seguridad:
   - X-Frame-Options
   - X-Content-Type-Options
   - Strict-Transport-Security
```

## üìä Performance Testing

### Core Web Vitals
```
M√©tricas importantes:
- Largest Contentful Paint (LCP) < 2.5s
- First Input Delay (FID) < 100ms
- Cumulative Layout Shift (CLS) < 0.1
```

### Load Testing (Opcional)
```bash
# Usar artillery.js para load testing
npm install -g artillery

# Crear artillery-test.yml
artillery run artillery-test.yml

# Verificar que app maneja 100+ requests concurrentes
```

## üéØ Testing Checklist Final

### Pre-Deployment
- [ ] Todos los manual tests pasan
- [ ] Build de producci√≥n exitoso
- [ ] Variables de entorno configuradas
- [ ] Base de datos de producci√≥n lista
- [ ] No secrets en c√≥digo
- [ ] Error handling probado

### Post-Deployment
- [ ] URL de producci√≥n funciona
- [ ] Auth flow en producci√≥n
- [ ] Forms funcionan en producci√≥n
- [ ] Dashboard muestra datos reales
- [ ] Performance acceptable (PageSpeed > 90)
- [ ] Responsive en dispositivos reales
- [ ] Cross-browser compatibility

### Ongoing Monitoring
- [ ] Error tracking configurado
- [ ] Uptime monitoring activo
- [ ] Performance monitoring
- [ ] Regular backup de base de datos
- [ ] Security headers verificados

---

## üéØ Resumen de Testing Strategy

1. ‚úÖ **Manual Testing sistem√°tico** - Cobertura completa de funcionalidad
2. ‚úÖ **Database verification** - Integridad de datos
3. ‚úÖ **Cross-browser testing** - Compatibilidad amplia
4. ‚úÖ **Responsive testing** - Mobile-first validated
5. ‚úÖ **Security testing** - Auth y data protection
6. ‚úÖ **Performance testing** - Core Web Vitals optimized
7. ‚úÖ **Production deployment** - Vercel + Supabase ready

**Tu MVP est√° listo para producci√≥n con testing completo!** üöÄ

**Pr√≥ximo archivo**: `05-Resumen-y-Arquitectura-Final.md`